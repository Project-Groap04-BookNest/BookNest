{% extends "base.html" %}
{% block content %}
<div class="max-w-4xl mx-auto mt-10 bg-white rounded-xl p-6 shadow">
  <h2 class="text-xl font-semibold mb-4">Manage Users</h2>

  <table class="w-full text-left border-collapse">
    <thead>
      <tr class="border-b">
        <th class="py-2">ID</th>
        <th class="py-2">Name</th>
        <th class="py-2">Email</th>
        <th class="py-2">Role</th>
      </tr>
    </thead>
    <tbody id="users-body"></tbody>
  </table>

  <div id="err" class="mt-3 text-red-600 text-sm"></div>
</div>

<script>
async function loadUsers() {
  const tbody = document.getElementById('users-body');
  const err = document.getElementById('err');
  tbody.innerHTML = '';
  err.textContent = '';

  try {
    const res = await fetch('/api/get_users');
    if (!res.ok) {
      const data = await res.json().catch(() => ({}));
      err.textContent = data.error || ('HTTP ' + res.status);
      return;
    }
    const users = await res.json();
    users.forEach(u => {
      const tr = document.createElement('tr');
      tr.className = 'border-b';
      tr.innerHTML = `
        <td class="py-2">${u.id}</td>
        <td class="py-2">${u.name}</td>
        <td class="py-2">${u.email}</td>
        <td class="py-2">${u.role}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch (e) {
    err.textContent = 'Cannot load users: ' + e.message;
  }
}
loadUsers();
</script>
{% endblock %}
